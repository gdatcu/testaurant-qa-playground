<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Testaurant – Testing Instructions & Playbooks (API + Web)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
  <style>
    :root{
      --ink:#0f172a;--muted:#475569;--bg:#f8fafc;--card:#ffffff;--border:#e5e7eb;--accent:#1e3a8a;--accent2:#0ea5e9;
      --ok:#059669;--bad:#dc2626;--warn:#d97706;
    }
    body{font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial; background:var(--bg); color:var(--ink); line-height:1.55}
    .container{max-width:1100px;margin:0 auto; padding:24px}
    nav.toc{position:sticky;top:0;background:var(--accent);padding:10px;border-radius:12px;margin-bottom:18px;z-index:5}
    nav.toc a{color:#fff;margin-right:14px;text-decoration:none;font-weight:700}
    h1{margin:0 0 10px 0}
    h2{margin:26px 0 10px}
    h3{margin:18px 0 8px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;margin:14px 0}
    .callout{background:#eff6ff;border-left:6px solid var(--accent2);padding:10px;border-radius:8px}
    pre{background:#0b1020;color:#e5e7eb;padding:14px;border-radius:10px;overflow:auto}
    code.inline{background:#eef2ff;border-radius:6px;padding:2px 6px}
    table{width:100%;border-collapse:collapse}
    th,td{border:1px solid var(--border);padding:8px;text-align:left;vertical-align:top}
    .grid{display:grid;gap:14px}
    .g2{grid-template-columns:1fr 1fr}
    .g3{grid-template-columns: repeat(3, 1fr)}
    .checklist{list-style:none;padding:0;margin:0}
    .checklist li{padding:6px 8px;border-left:4px solid var(--border);margin:6px 0;background:#fff;border-radius:8px}
    .checklist li.ok{border-left-color:var(--ok);background:#ecfdf5}
    .checklist li.bad{border-left-color:var(--bad);background:#fef2f2}
    .muted{color:var(--muted)}
    .sep{height:1px;background:var(--border);margin:18px 0}
    .btn-row{display:flex;gap:10px;flex-wrap:wrap}
    .btn{display:inline-block;background:var(--accent);color:#fff;padding:10px 14px;border-radius:10px;text-decoration:none;font-weight:700}
  </style>
</head>
<body>
<div class="container">
  <h1>📋 Testaurant – Testing Instructions & Playbooks</h1>
  <p class="muted">Everything you need to test the API and Web app: step-by-step smoke flows, exhaustive matrices, negative testing, chaos drills, and admin exercises — with expected results.</p>

  <nav class="toc">
    <a href="#env">Environment & Base URLs</a>
    <a href="#smoke-api">API Smoke</a>
    <a href="#api-matrix">API Test Matrix</a>
    <a href="#api-negative">API Negative & Edge</a>
    <a href="#api-chaos">Chaos & Resilience</a>
    <a href="#api-admin">Admin Endpoints</a>
    <a href="#web-smoke">Web Smoke</a>
    <a href="#web-matrix">Web Test Matrix</a>
    <a href="#checklists">Progress Checklists</a>
    <a href="#labs">Mini-Labs</a>
  </nav>

  <!-- ENV -->
  <section id="env">
    <h2>1) Environment & Base URLs</h2>
    <div class="card">
      <p><b>Site base:</b> <span class="code inline">https://apps.qualiadept.eu/testaurant</span></p>
      <ul>
        <li>API root: <span class="code inline">/api</span> (e.g., <span class="code inline">/api/health</span>)</li>
        <li>Frontend entry: <span class="code inline">/frontend/index.html</span></li>
      </ul>
      <p><b>Admin header:</b> <span class="code inline">X-API-Key: &lt;your_admin_api_key&gt;</span> for protected endpoints.</p>
    </div>
  </section>

  <!-- API SMOKE -->
  <section id="smoke-api">
    <h2>2) API Smoke Tests (happy path)</h2>
    <div class="grid g2">
      <div class="card">
        <h3>2.1 Health</h3>
        <pre><code># Expect: 200, {"ok": true}
curl -s https://apps.qualiadept.eu/testaurant/api/health</code></pre>
        <pre><code>{
  "ok": true,
  "time": "2025-09-07T16:18:27+03:00"
}</code></pre>
      </div>
      <div class="card">
        <h3>2.2 Categories</h3>
        <pre><code># Expect: 200, categories non-empty
curl -s https://apps.qualiadept.eu/testaurant/api/categories</code></pre>
      </div>
    </div>

    <div class="grid g2">
      <div class="card">
        <h3>2.3 Menu (pagination + currency)</h3>
        <pre><code># Expect: 200, items array, page/limit echoed
curl -s "https://apps.qualiadept.eu/testaurant/api/menu?page=1&amp;limit=5&amp;currency=EUR"</code></pre>
      </div>
      <div class="card">
        <h3>2.4 Cart price</h3>
        <pre><code># Expect: 200, totals with/without coupon, optional currency conversions
curl -s -X POST https://apps.qualiadept.eu/testaurant/api/cart/price \
  -H "Content-Type: application/json" \
  -d '{ "items":[{"id":1,"qty":1},{"id":3,"qty":1}], "deliveryMethod":"pickup", "couponCode":null, "currency":"RON" }'</code></pre>
      </div>
    </div>

    <div class="grid g2">
      <div class="card">
        <h3>2.5 Checkout (idempotent)</h3>
        <pre><code># Expect: 200, {orderId, payment, total}; replay with same Idempotency-Key returns same orderId
curl -s -X POST https://apps.qualiadept.eu/testaurant/api/checkout \
  -H "Content-Type: application/json" \
  -H "Idempotency-Key: demo-12345" \
  -d '{ "customerName":"Jane QA","customerPhone":"+40123456789",
        "items":[{"id":1,"qty":1}],
        "paymentMethod":"card","deliveryMethod":"pickup",
        "currency":"RON" }'</code></pre>
      </div>
      <div class="card">
        <h3>2.6 Orders (admin)</h3>
        <pre><code># Expect: 200 with admin key; 403 without
curl -s -H "X-API-Key: &lt;ADMIN_KEY&gt;" \
  "https://apps.qualiadept.eu/testaurant/api/orders?page=1&amp;limit=10"</code></pre>
      </div>
    </div>
  </section>

  <!-- API MATRIX -->
  <section id="api-matrix">
    <h2>3) API Test Matrix (coverage table)</h2>
    <div class="card">
      <table>
        <thead>
          <tr>
            <th>Area</th><th>Inputs</th><th>Expected</th><th>Notes</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Menu pagination</td>
            <td>page=1..N, limit=1,5,20,100</td>
            <td>200; items length ≤ limit; page &amp; limit echoed</td>
            <td>limit &gt; 100 → capped at 100</td>
          </tr>
          <tr>
            <td>Menu filters</td>
            <td>q=pizza, category=Pizza</td>
            <td>Only matching items</td>
            <td>Case-insensitive LIKE</td>
          </tr>
          <tr>
            <td>Currency</td>
            <td>?currency=RON/EUR/USD</td>
            <td>Converted fields present (price_converted / display totals)</td>
            <td>Rates managed by /api/rates</td>
          </tr>
          <tr>
            <td>Cart price</td>
            <td>items=[{id,qty}], deliveryMethod pickup/delivery, couponCode optional</td>
            <td>200; subtotal, vat, discount, deliveryFee, grandTotal</td>
            <td>Coupon under minSubtotal → 422</td>
          </tr>
          <tr>
            <td>Checkout</td>
            <td>Valid customer + items + payment + delivery</td>
            <td>200; orderId; payment authorized/captured; stock decremented</td>
            <td>Repeat with same Idempotency-Key → same orderId</td>
          </tr>
          <tr>
            <td>Orders list (admin)</td>
            <td>X-API-Key</td>
            <td>200; orders[]</td>
            <td>Missing/invalid key → 403</td>
          </tr>
          <tr>
            <td>Order detail</td>
            <td>/api/orders/{id}?currency=EUR</td>
            <td>200; items[], payment</td>
            <td>Not found → 404</td>
          </tr>
          <tr>
            <td>Inventory (admin)</td>
            <td>GET /api/inventory; PUT /menuitems/{id}/stock</td>
            <td>200; stock updated</td>
            <td>Negative stock coerced to 0</td>
          </tr>
          <tr>
            <td>Rates (admin)</td>
            <td>POST /api/rates {EUR,USD}</td>
            <td>200; GET /rates shows list</td>
            <td>Rate &gt; 0</td>
          </tr>
          <tr>
            <td>Stats (admin)</td>
            <td>GET /api/stats?from=YYYY-MM-DD&amp;to=YYYY-MM-DD&amp;currency=USD</td>
            <td>200; orders_count, revenue_sum, by_day[], top_items[]</td>
            <td>Date boundaries inclusive</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- API NEGATIVE -->
  <section id="api-negative">
    <h2>4) API Negative & Edge Cases</h2>
    <div class="grid g2">
      <div class="card">
        <h3>Validation failures</h3>
        <pre><code># Missing required fields → 422
curl -s -X POST https://apps.qualiadept.eu/testaurant/api/checkout \
 -H "Content-Type: application/json" -d '{}'</code></pre>
        <pre><code># Coupon below minSubtotal → 422
curl -s -X POST https://apps.qualiadept.eu/testaurant/api/cart/price \
 -H "Content-Type: application/json" \
 -d '{ "items":[{"id":1,"qty":1}], "couponCode":"SUMMER10" }'</code></pre>
      </div>
      <div class="card">
        <h3>Stock conflicts</h3>
        <pre><code># Excessive qty → 409 (or 422 depending on path)
curl -s -X POST https://apps.qualiadept.eu/testaurant/api/cart/price \
 -H "Content-Type: application/json" \
 -d '{ "items":[{"id":1,"qty":9999}] }'</code></pre>
      </div>
    </div>

    <div class="grid g2">
      <div class="card">
        <h3>Authorization</h3>
        <pre><code># 403 without admin key
curl -s https://apps.qualiadept.eu/testaurant/api/inventory</code></pre>
      </div>
      <div class="card">
        <h3>Idempotency behavior</h3>
        <pre><code># First call creates order; second call with same key returns same orderId
curl -s -X POST https://apps.qualiadept.eu/testaurant/api/checkout \
 -H "Idempotency-Key: fixed-key-001" \
 -H "Content-Type: application/json" \
 -d '{ "customerName":"Ana QA","customerPhone":"+401111",
       "items":[{"id":1,"qty":1}], "paymentMethod":"cash","deliveryMethod":"pickup" }'</code></pre>
      </div>
    </div>
  </section>

  <!-- CHAOS -->
  <section id="api-chaos">
    <h2>5) Chaos & Resilience Playbook</h2>
    <div class="card">
      <p>Use built-in chaos hooks to simulate latency and transient failures:</p>
      <ul>
        <li><span class="code inline">?slow=1000</span> → adds ~1s delay</li>
        <li><span class="code inline">?chaos=1</span> → random 100–1200ms delays & occasional 503</li>
      </ul>
      <pre><code># Example: slow health
curl -s "https://apps.qualiadept.eu/testaurant/api/health?slow=1000"</code></pre>
      <div class="grid g2">
        <div class="card">
          <h3>Retry/backoff strategy</h3>
          <ul>
            <li>Limit retries (e.g., max 3)</li>
            <li>Exponential backoff (250ms → 500ms → 1s)</li>
            <li>Only retry idempotent GET/POST with Idempotency-Key</li>
          </ul>
        </div>
        <div class="card">
          <h3>Assertions under chaos</h3>
          <ul>
            <li>Allow timing variance, keep strict on status/payload</li>
            <li>Record request/response timings to spot outliers</li>
            <li>Use circuit breakers in client libs (advanced)</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- ADMIN -->
  <section id="api-admin">
    <h2>6) Admin Endpoints – Hands-on Drills</h2>
    <div class="grid g2">
      <div class="card">
        <h3>Inventory view + stock update</h3>
        <pre><code># Get list
curl -s -H "X-API-Key: &lt;ADMIN_KEY&gt;" https://apps.qualiadept.eu/testaurant/api/inventory

# Set absolute stock to 7
curl -s -X PUT -H "X-API-Key: &lt;ADMIN_KEY&gt;" -H "Content-Type: application/json" \
 https://apps.qualiadept.eu/testaurant/api/menuitems/1/stock \
 -d '{ "stock": 7 }'</code></pre>
      </div>
      <div class="card">
        <h3>Restock & availability</h3>
        <pre><code># Increment stock by +5
curl -s -X POST -H "X-API-Key: &lt;ADMIN_KEY&gt;" -H "Content-Type: application/json" \
 https://apps.qualiadept.eu/testaurant/api/menuitems/1/restock \
 -d '{ "delta": 5 }'

# Hide item (available = 0)
curl -s -X POST -H "X-API-Key: &lt;ADMIN_KEY&gt;" -H "Content-Type: application/json" \
 https://apps.qualiadept.eu/testaurant/api/menuitems/1/availability \
 -d '{ "available": 0 }'</code></pre>
      </div>
    </div>

    <div class="grid g2">
      <div class="card">
        <h3>Rates & currency checks</h3>
        <pre><code># Upsert EUR rate
curl -s -X POST -H "X-API-Key: &lt;ADMIN_KEY&gt;" -H "Content-Type: application/json" \
 https://apps.qualiadept.eu/testaurant/api/rates \
 -d '{ "currency":"EUR", "rate":0.2 }'

# Verify via menu
curl -s "https://apps.qualiadept.eu/testaurant/api/menu?currency=EUR&amp;page=1&amp;limit=3"</code></pre>
      </div>
      <div class="card">
        <h3>Stats (dashboard)</h3>
        <pre><code># Expect by_day & top_items
curl -s -H "X-API-Key: &lt;ADMIN_KEY&gt;" \
 "https://apps.qualiadept.eu/testaurant/api/stats?from=2025-01-01&amp;to=2025-12-31&amp;currency=USD"</code></pre>
      </div>
    </div>
  </section>

  <!-- WEB SMOKE -->
  <section id="web-smoke">
    <h2>7) Web/UI Smoke – What to verify manually</h2>
    <div class="card">
      <ol>
        <li>Menu cards render with images, name, price, and <span class="code inline">Add</span> button.</li>
        <li>Add 1–2 items → toast confirms and cart badge increments.</li>
        <li>Open cart → line items, VAT & totals correct.</li>
        <li>Switch currency in header → totals update consistently.</li>
        <li>Apply coupon (if exposed in UI) → discount reflected.</li>
        <li>Checkout form: valid inputs enable submit; placing an order shows confirmation.</li>
        <li>Admin tabs (Inventory / Orders / Stats) reachable if enabled in UI.</li>
      </ol>
    </div>
    <div class="grid g2">
      <div class="card">
        <h3>Accessibility quick scan</h3>
        <ul>
          <li>Images have <span class="code inline">alt</span>; focus outlines visible</li>
          <li>Buttons announce role/label to screen readers</li>
          <li>Color contrast meets WCAG AA (spot-check)</li>
        </ul>
      </div>
      <div class="card">
        <h3>Responsive checks</h3>
        <ul>
          <li>320px (mobile): grid collapses; no clipped CTAs</li>
          <li>768–1024px (tablet): nav remains usable</li>
          <li>≥1280px (desktop): content centered, readable</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- WEB MATRIX -->
  <section id="web-matrix">
    <h2>8) Web Test Matrix</h2>
    <div class="card">
      <table>
        <thead>
          <tr><th>Area</th><th>Scenario</th><th>Expected</th><th>Notes</th></tr>
        </thead>
        <tbody>
          <tr>
            <td>Cards</td>
            <td>Image loads or fallback; Add button visible</td>
            <td>No broken layout; hover states OK</td>
            <td>Broken image → renders fallback</td>
          </tr>
          <tr>
            <td>Cart</td>
            <td>Add/remove items, change qty (if supported)</td>
            <td>Totals recompute; VAT correct</td>
            <td>Rounding: 2 decimals</td>
          </tr>
          <tr>
            <td>Currency</td>
            <td>Switch RON↔EUR↔USD</td>
            <td>Prices/totals re-render; labels reflect currency</td>
            <td>Stays consistent across pages</td>
          </tr>
          <tr>
            <td>Checkout validation</td>
            <td>Empty name/phone</td>
            <td>Inline error; disabled submit</td>
            <td>Phone pattern +4… accepted</td>
          </tr>
          <tr>
            <td>Confirmations</td>
            <td>Toast/banner after actions</td>
            <td>Visible within 1s; auto-dismiss (if designed)</td>
            <td>Screen-reader friendly (aria-live)</td>
          </tr>
          <tr>
            <td>Inventory UI (admin)</td>
            <td>Set stock, restock</td>
            <td>Row reflects new stock immediately</td>
            <td>API key requirement handled in UI</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- CHECKLISTS -->
  <section id="checklists">
    <h2>9) Progress Checklists</h2>
    <div class="grid g2">
      <div class="card">
        <h3>API Progress</h3>
        <ul class="checklist">
          <li>Health & Categories green</li>
          <li>Menu pagination & filters validated</li>
          <li>Currency conversions checked</li>
          <li>Cart price (coupon / delivery) correct</li>
          <li>Checkout idempotency verified</li>
          <li>Orders list/detail (admin) working</li>
          <li>Inventory stock/availability updates</li>
          <li>Rates upsert & reflected in menu</li>
          <li>Stats reflect recent orders</li>
          <li>Chaos: retry/backoff working</li>
        </ul>
      </div>
      <div class="card">
        <h3>Web Progress</h3>
        <ul class="checklist">
          <li>Cards render with images and prices</li>
          <li>Cart flows (add/remove) correct</li>
          <li>Currency switch updates UI</li>
          <li>Checkout validation & success</li>
          <li>Toasts/confirmations visible</li>
          <li>Responsive @ 320/768/1280 widths</li>
          <li>Basic a11y checks pass</li>
          <li>Admin UI (if present) operational</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- MINI LABS -->
  <section id="labs">
    <h2>10) Mini-Labs (guided practice)</h2>
    <div class="grid g2">
      <div class="card">
        <h3>Lab A – Currency correctness</h3>
        <ol>
          <li>POST <span class="code inline">/api/rates</span> EUR=0.20 (admin).</li>
          <li>GET <span class="code inline">/api/menu?currency=EUR&amp;limit=3</span>.</li>
          <li>For each item: verify <span class="code inline">price_converted ≈ price × 0.20</span> (±0.01).</li>
        </ol>
        <p><b>Expected:</b> All three items match the conversion within rounding tolerance.</p>
      </div>
      <div class="card">
        <h3>Lab B – Idempotent checkout</h3>
        <ol>
          <li>POST <span class="code inline">/api/checkout</span> with <span class="code inline">Idempotency-Key: lab-b-1</span>.</li>
          <li>Repeat same request with the same key.</li>
          <li>Compare <span class="code inline">orderId</span>s → must be equal.</li>
        </ol>
        <p><b>Expected:</b> Same <span class="code inline">orderId</span>; no stock double-decrement.</p>
      </div>
    </div>

    <div class="grid g2">
      <div class="card">
        <h3>Lab C – Stock boundary</h3>
        <ol>
          <li>Set stock of item #1 to 1 via admin.</li>
          <li>Place two checkouts in quick succession for the same item.</li>
          <li>One should succeed; the other must fail (409) or be prevented by idempotency.</li>
        </ol>
        <p><b>Expected:</b> Inventory never goes negative; failure message explains.</p>
      </div>
      <div class="card">
        <h3>Lab D – Chaos tolerance</h3>
        <ol>
          <li>Call <span class="code inline">/api/health?chaos=1</span> with a simple retry loop (max 3).</li>
          <li>Record attempts and final status.</li>
        </ol>
        <p><b>Expected:</b> Eventually 200 OK (unless unlucky), no infinite retries.</p>
      </div>
    </div>
  </section>

  <div class="sep"></div>
  <div class="btn-row">
    <a class="btn" href="index.html">← Back to Home</a>
    <a class="btn" href="#api-matrix">Jump to API Matrix</a>
  </div>
  <p class="muted">End of instructions page.</p>
</div>
</body>
</html>
